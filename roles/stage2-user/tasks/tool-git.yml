---
- tags:
    - dotfiles
    - git
  block:
    - name: copy git config directory
      copy:
        src: '.config/git/'
        dest: '{{ lookup("env", "HOME") }}/.config/git/'
        mode: '755'

    - name: create git config file
      template:
        src: '.config/git/config.j2'
        dest: '{{ lookup("env", "HOME") }}/.config/git/config'

    - name: create development directories
      file:
        name: '{{ lookup("env", "HOME") }}/{{ item }}'
        state: directory
      with_items:
        - 'Development'
        - 'Development/github.com'
        - 'Development/gitlab.com'
      tags:
        - git
        - git-workspace

    - name: create git-workspace fragments
      copy:
        src: 'Development/.git-workspace.d/'
        dest: '{{ lookup("env", "HOME") }}/Development/.git-workspace.d/'
        mode: '0644'
      tags:
        - git-workspace

    - name: assemble git-workspace config
      ansible.builtin.assemble:
        src: '{{ lookup("env", "HOME") }}/Development/.git-workspace.d/'
        dest: '{{ lookup("env", "HOME") }}/Development/workspace.toml'
        delimiter: '\n'
      tags:
        - git-workspace
