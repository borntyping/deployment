---
- become: true
  tags:
    - stage1
    - stage1-base
  block:
    - import_tasks: apt.yml
      tags: apt

    - name: install packages
      ansible.builtin.apt:
        state: latest
        pkg:
          - ack
          - ansible
          - asciinema
          - colordiff
          - curl
          - direnv
          - fd-find
          - git
          - git-lfs
          - golang
          - htop
          - hub
          - letsencrypt
          - libgit2-dev
          - libxml2-dev
          - libxslt1-dev
          - libyaml-dev
          - micro
          - nano
          - plantuml
          - python3
          - python3-dev
          - python3-pip
          - shellcheck
          - tree
          - zsh
      tags:
        - bin
        - util

    - name: install docker
      ansible.builtin.apt:
        pkg:
          - docker-ce
          - docker-ce-cli
          - containerd.io
        state: latest

    - name: create docker group
      ansible.builtin.group:
        name: docker
        state: present

    - name: add current user to docker group
      ansible.builtin.user:
        name: '{{ lookup("env", "USER") }}'
        groups: docker
        append: true

    - name: install git-get
      ansible.builtin.apt:
        deb: https://github.com/grdl/git-get/releases/download/v0.4.0/git-get_0.4.0_linux_amd64.deb
        state: present
      become: yes
      tags:
       - git
       - git-get
