---
- become: true
  tags:
    - 'stage1'
    - 'stage1-base'
  block:
    - name: 'install apt packages'
      ansible.builtin.apt:
        state: 'latest'
        pkg:
          - 'ack'
          - 'asciinema'
          - 'bat'
          - 'cargo'
          - 'colordiff'
          - 'curl'
          - 'direnv'
          - 'docker-compose'
          - 'exa'                       # ls replacement
          - 'fd-find'                   # find replacement
          - 'fzf'                       # shell menu
          - 'git-lfs'                   # git large file support
          - 'git'                       # git
          - 'htop'
          - 'jq'
          - 'libpam-u2f'
          - 'micro'
          - 'mlocate'
          - 'nano'
          - 'podman-docker'
          - 'python-is-python3'
          - 'python3-dev'
          - 'python3-pip'
          - 'python3'
          - 'ripgrep'                   # grep replacement
          - 'rust-clippy'
          - 'rust-src'
          - 'rustc'
          - 'rustfmt'
          - 'shellcheck'
          - 'tree'
          - 'wl-clipboard'
          - 'zoxide'
          - 'zsh-autosuggestions'
          - 'zsh-syntax-highlighting'
          - 'zsh'
      tags:
        - 'apt'

    - name: 'remove apt packages'
      ansible.builtin.apt:
        state: absent
        pkg:
          - 'black'                     # Installed with pip.
          - 'pipenv'                    # 2022-08-23: Ubuntu's pipenv package is from 2018.
          - 'pipx'                      # Installed with pip.
          - 'python3-poetry'            # Installed with pip.
          - 'python3-cachecontrol'      # Installed with pip.
          - 'python3-pytest'            # Install this in virtualenvs.
          - 'httpie'                    # Installed with pip.
          - 'mypy'                      # Install this in virtualenvs.
          - 'hub'                       # Switched to 'gh'.
      tags:
        - 'apt'

    - name: 'install snap packages with --classic'
      tags: ['python', 'snap']
      community.general.snap:
        name: '{{ item }}'
        classic: true
      loop:
        - 'pycharm-professional'
      tags:
        - 'snap'

    - name: 'configure sudo'
      ansible.builtin.copy:
        src: 'etc/sudoers.d/sam'
        dest: '/etc/sudoers.d/sam'
      tags:
        - docker
        - sudo
        - sudoers

    - name: 'configure varmilo keyboard'
      ansible.builtin.copy:
        src: 'etc/modprobe.d/hid_apple.conf'
        dest: '/etc/modprobe.d/hid_apple.conf'
      tags:
        - never
        - hardware
